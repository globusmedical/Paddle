# Instructions for building PaddlePaddle CPU from Source
# activate your python environment

pip install numpy, protobuf, wheel
pip install ninja

# ===== For Windows 10 =====
# compile with ninja 

mkdir build && cd build

cmake .. -GNinja -DWITH_GPU=OFF

ninja install all

# compile with cmake and MSVS 2017

cmake .. -GNinja -G "Visual Studio 15 2017" -A x64 host=x64 -DWITH_GPU=OFF

# open the solution file in build folder and build all for x64 release

# ===== For Linux =====
# Option 1: Docker


# Option 2: DIY
# activate your python environment; could use virtualenv or conda

sudo apt update -y
sudo apt install -y bzip2 make
sudo apt install -y patchelf

mkdir build && cd build

export PYTHON_INCLUDE_DIR=$(python -c "from distutils.sysconfig import get_python_inc; print(get_python_inc())")
export PYTHON_LIBRARY=$(python -c "from distutils.sysconfig import get_python_lib; print(get_python_lib())")
export PYTHON_VERSION=$(python -c "from distutils.sysconfig import get_python_version; print(get_python_version())")

cmake .. -D CMAKE_C_COMPILER=/usr/local/gcc-8.2/bin/gcc \
    -D CMAKE_CXX_COMPILER=/usr/local/gcc-8.2/bin/g++ \
    -DPY_VERSION=${PYTHON_VERSION} \
    -DPYTHON_INCLUDE=${PYTHON_INCLUDE_DIR} \
    -DPYTHON_LIBRARY=${PYTHON_LIBRARY} -DWITH_GPU=OFF 

make -j$(nproc)